# RM2020 哨兵 工程框架

Author: ThunderDoge

2020-3-19

> 一直是测试版。没有发布版。直到上场前五分钟。

## 工程环境

- Toolchain/IDE : MDK-ARM V5.28
- package version: STM32Cube FW_F4 V1.24.0
- FreeRTOS version: FreeRTOS Kernel V10.0.1
- CMSIS-RTOS version: 1.02

> 注意：需求不是持久不变，框架不是一定不变，要随时更新，随时重构——Evan-GH

## 需求分析

> 电控最主要的，是做一个好的执行器。——Evan-GH

**哨兵机器人是服务于视觉小主机的设备**

**粗略需求分析**

云台基础动作：快速响应小主机动作指令。瞄准角动态快速收敛无抖动；静态无静差。

底盘轨上运动：轨上设定位置移动，自动处理撞柱。功率控制。Dodge机动（使用缓冲能量）。

发射机构：拨弹轮转动模式控制、堵转检测。摩擦轮转速控制。

裁判系统通讯：裁判系统信息读取，及时给到小主机。裁判系统配合功率控制。裁判系统串口冗余：防止串口线断掉就全崩。

人机互动：使用OLED显示出错的设备，b便于DEBUG。

鲁棒性：设备离线时的对策。

**子系统功能划分及指标**

- 上/下云台子系统
  - 基础瞄准动作
  - 陀螺仪数据旋转变换。（我数学不好）
  - 发现在某些角度机械角会无端抖动。设计了机械角和陀螺仪控制无缝切换。设定在某些角度下自动切换（对小主机来说隐形的功能）
  - 枪口热量管理。枪口发射模式管理。
  - 上云台是与小主机通信的。向其他板子发送小主机指令。向小主机发送各子系统信息。
- 底盘子系统
  - 底盘编码器和激光测距模块。准确给出轨上位置和速度。
  - 功率控制和缓冲能量管理。设定不使用缓冲能量时，做到任意移动指令不超功率，阶跃响应稳态收敛0.5s内。稳定时能量使用率至少90%。
  - 使用缓冲能量进行闪避机动。即使用缓冲能量，短时间内电机全力输出。另确保多次使用闪避机动（能量不足时）确保不过热。
- 板间CAN通讯
  - 三个子系统链接到一个CAN网络，用于板间信息交换。
  - 板子的物理信息等会在CAN线上进行广播。通用的CAN_ID


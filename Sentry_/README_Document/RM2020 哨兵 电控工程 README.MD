# RM2020 哨兵 电控工程 README

**v1.0 by ThunderDoge 2020/0207**

[TOC]



## 概述

你好，工程师。

我是哨兵电控ThunderDoge。本文档用于记录 哨兵的MCU代码工程构建逻辑、实现的效果，以及BUG记录。希望对你有帮助。如果有任何问题请邮件至 thunderdoge@qq.com

哨兵是RM比赛中独特的全自动机器人，仅能依靠摄像头和其他传感器获取信息并自主做出判断，另可从裁判系统获取其他机器人发予的短消息指令。这对其 **鲁棒性** 提出较高要求，主要是程序逻辑的鲁棒性，以及应对电气故障的鲁棒性。机器人的设计思路是在保证鲁棒性的情况下尽可能地提高性能。

哨兵机器人分上下云台及底盘，共三部分，每部分各有一个MCU控制。MCU之间通过**CAN（可能根据设计而更改为UART）**互相通讯。每个MCU均可以独立运行（切断与其他MCU通讯情况下）。每个MCU均可独立地获取裁判系统信息，云台MCU可以获取各自的小主机的指令。

## 文档阅读方法

本文档包含：**电气连接拓扑、程序运行时逻辑、源文件依赖关系、调试指南**

本文档依赖文档：**《RM2020 哨兵.上云台 电控工程 README》《RM2020 哨兵.底盘 电控工程 README》《RM2020 哨兵.下云台 电控工程 README》**以提供细节说明

## 电气连接拓扑

[Insert Img Here]

参阅 ***RM2020哨兵电气连接图v1.0.vsdx***

## 程序运行时逻辑.云台

简单的RTOS系统，只有两个线程（任务），线程（任务）只有运行频率的区别。线程与中断、线程之间的交流通过各种全局变量进行。（因为这样比较简单，采用RTOS的信号量和消息队列不必要地复杂）

### 初始化

起始于`main.c`，历经`TaskStarter()`的`Cloud_Init()`来启动各种硬件（如果启动失败会在这里死循环）——具体有关硬件见源码，然后由`xTaskCreate()`创建：

- task_Main	///< 主任务，负责逻辑，1KHz
- task_CommuRoutine	///<通讯任务，200Hz

两个常驻任务。

### 运行时信息流

接收信息由中断触发，在中断函数里面解析，写到缓存结构体里面。处理信息的主逻辑位于task_Main，而task_CommuRoutine负责定时地发送信息。

详见运行时信息流图解.vsdx

### 源文件依赖关系

## 调试指南

设置程序需要的操作记录在这里。

### 设置









